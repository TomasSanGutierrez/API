<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>API de Rick y Morty</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-dark text-light" style="
  background-image: url('img/fondo.jpg');
  background-repeat: no-repeat;
  background-position: center;
  background-attachment: fixed;
  background-size: cover;
">

  <div class="container my-4 p-4 rounded-4 bg-dark bg-opacity-75 shadow-lg">
    <h1 class="text-center text-success mb-4 fw-bold">Rick y Morty - Episodios y Personajes</h1>


    <div class="card bg-success bg-opacity-25 border-0 p-3 mb-4">
      <h5 class="text-center text-warning mb-3 fw-semibold">Buscar personaje por ID</h5>
      <div class="input-group">
        <input id="idPersonaje" type="number" min="1" class="form-control border-0"
          placeholder="Número de personaje (1 a 826)">
        <button id="buscar" class="btn btn-warning fw-bold text-dark">Buscar</button>
      </div>
      <div id="resultado" class="mt-4 text-center"></div>
    </div>


    <h3 class="text-center text-info mb-3 fw-bold">Personajes Principales</h3>
    <div class="row" id="principales"></div>


    <h3 class="text-center text-success mt-5 mb-3 fw-bold">Episodios</h3>
    <div id="episodios"></div>
  </div>

  <script>
    const API = "https://rickandmortyapi.com/api/";
    const principales = [1, 2, 3, 4, 5];

    const crearCard = p => `
      <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
        <div class="card bg-dark text-light border-success h-100 shadow">
          <img src="${p.image}" class="card-img-top border-bottom border-success" alt="${p.name}">
          <div class="card-body text-center">
            <h6 class="card-title text-warning fw-bold">${p.name}</h6>
            <p class="mb-1 small">ID: ${p.id}</p>
            <p class="mb-1 small">${p.species} - ${p.status}</p>
            <p class="mb-0 small">Episodio: ${p.episode[0]?.split("/").pop() || "?"}</p>
          </div>
        </div>
      </div>`;

    async function cargarPrincipales() {
      for (let id of principales) {
        const p = await (await fetch(API + "character/" + id)).json();
        principalesDiv.innerHTML += crearCard(p);
      }
    }

    async function cargarEpisodios() {
      const eps = await (await fetch(API + "episode")).json();
      for (let e of eps.results) {
        const div = document.createElement("div");
        div.className = "card bg-success bg-opacity-25 border-0 p-3 mb-4";
        div.innerHTML = `
          <h5 class="text-warning fw-bold">${e.episode} - ${e.name}</h5>
          <p class="text-info">${e.air_date}</p>
          <div class="row"></div>`;
        const cont = div.querySelector(".row");
        for (let url of e.characters.slice(0, 6)) {
          const id = +url.split("/").pop();
          if (principales.includes(id)) continue;
          const p = await (await fetch(url)).json();
          cont.innerHTML += crearCard(p);
        }
        episodiosDiv.appendChild(div);
      }
    }

    document.getElementById("buscar").onclick = async () => {
      const id = document.getElementById("idPersonaje").value;
      if (!id) return alert("Ingresa un número válido.");
      resultado.innerHTML = "<p class='text-light'>Cargando...</p>";
      try {
        const p = await (await fetch(API + "character/" + id)).json();
        resultado.innerHTML = `
          <div class="card bg-dark text-light mx-auto border-success shadow" style="max-width: 300px;">
            <img src="${p.image}" class="card-img-top border-bottom border-success">
            <div class="card-body text-center">
              <h5 class="text-warning fw-bold">${p.name}</h5>
              <p>ID: ${p.id}</p>
              <p>${p.species} - ${p.status}</p>
              <p><strong>Episodio inicial:</strong> ${p.episode[0]?.split("/").pop() || "?"}</p>
            </div>
          </div>`;
      } catch {
        resultado.innerHTML = "<p class='text-danger fw-bold'>No encontrado.</p>";
      }
    };

    const principalesDiv = document.getElementById("principales");
    const episodiosDiv = document.getElementById("episodios");
    const resultado = document.getElementById("resultado");

    cargarPrincipales();
    cargarEpisodios();
  </script>
</body>


</html>
